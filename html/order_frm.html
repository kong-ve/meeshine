<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>AUI快速完成布局</title>
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
    <style type="text/css">
        .goods-title {
            color: #757575 !important;
        }
        .goods-price {
            color: #666666 !important;
            font-weight: 700;
        }
        #body_main{
          height: 100%;
        }
        #empty_cart{
          display: none;
          position: absolute;
          top: 40%;
          left: 25%;
          height: 50%;
        }
        #empty_cart p:first-child{
          color: #aeaeae;
          text-align: center;
          width: 100%;
        }
    </style>
</head>
<body>

    <section class="aui-content" id="body_main">
        <!-- <div class="aui-card-list aui-border-t aui-border-b">
            <div class="aui-card-list-header aui-card-list-user">
                <div class="aui-card-list-user-avatar">
                    <img src="../image/demo1.png">
                </div>
                <div class="aui-card-list-user-name">
                    <div class="aui-font-size-16">陕十三肉夹馍 <i class="aui-iconfont aui-icon-right aui-font-size-12"></i></div>
                    <small>订单已完成</small>
                </div>
                <div class="aui-card-list-user-info">5小时30分钟前</div>
            </div>
            <div class="aui-card-list-content aui-border-t" style="margin-left: 3.5rem;">
                <ul class="aui-list aui-list-noborder">
                    <div class="aui-list-item aui-padded-l-0">
                        <div class="aui-list-item-inner">
                            <div class="aui-list-item-title aui-font-size-14 goods-title">超值单人餐</div>
                            <div class="aui-list-item-right goods-price">￥55</div>
                        </div>
                    </div>
                    <div class="aui-list-item aui-padded-l-0">
                        <div class="aui-list-item-inner">
                            <div class="aui-list-item-title aui-font-size-14 goods-title">超值单人餐</div>
                            <div class="aui-list-item-right goods-price">￥55</div>
                        </div>
                    </div>
                </ul>
            </div>
            <div class="aui-card-list-footer aui-border-t">
                <div></div>
                <div>
                    <div class="aui-btn aui-btn aui-btn-outlined aui-btn-info aui-margin-r-10">再来一单</div>
                    <div class="aui-btn aui-btn aui-btn-outlined aui-btn-warning">评价得积分</div>
                </div>
            </div>
        </div>
        <div class="aui-card-list aui-border-t aui-border-b">
            <div class="aui-card-list-header aui-card-list-user">
                <div class="aui-card-list-user-avatar">
                    <img src="../image/demo1.png">
                </div>
                <div class="aui-card-list-user-name">
                    <div class="aui-font-size-16">陕十三肉夹馍 <i class="aui-iconfont aui-icon-right aui-font-size-12"></i></div>
                    <small>订单已完成</small>
                </div>
                <div class="aui-card-list-user-info">5小时30分钟前</div>
            </div>
            <div class="aui-card-list-content aui-border-t" style="margin-left: 3.5rem;">
                <ul class="aui-list aui-list-noborder">
                    <div class="aui-list-item aui-padded-l-0">
                        <div class="aui-list-item-inner">
                            <div class="aui-list-item-title aui-font-size-14 goods-title">超值单人餐</div>
                            <div class="aui-list-item-right goods-price">￥55</div>
                        </div>
                    </div>
                    <div class="aui-list-item aui-padded-l-0">
                        <div class="aui-list-item-inner">
                            <div class="aui-list-item-title aui-font-size-14 goods-title">超值单人餐</div>
                            <div class="aui-list-item-right goods-price">￥55</div>
                        </div>
                    </div>
                </ul>
            </div>
            <div class="aui-card-list-footer aui-border-t">
                <div></div>
                <div>
                    <div class="aui-btn aui-btn aui-btn-outlined aui-btn-warning">评价得积分</div>
                </div>
            </div>
        </div>
        <div class="aui-card-list aui-border-t aui-border-b">
            <div class="aui-card-list-header aui-card-list-user">
                <div class="aui-card-list-user-avatar">
                    <img src="../image/demo1.png">
                </div>
                <div class="aui-card-list-user-name">
                    <div class="aui-font-size-16">陕十三肉夹馍 <i class="aui-iconfont aui-icon-right aui-font-size-12"></i></div>
                    <small>订单已完成</small>
                </div>
                <div class="aui-card-list-user-info">5小时30分钟前</div>
            </div>
            <div class="aui-card-list-content aui-border-t" style="margin-left: 3.5rem;">
                <ul class="aui-list aui-list-noborder">
                    <div class="aui-list-item aui-padded-l-0">
                        <div class="aui-list-item-inner">
                            <div class="aui-list-item-title aui-font-size-14 goods-title">超值单人餐</div>
                            <div class="aui-list-item-right goods-price">￥55</div>
                        </div>
                    </div>
                    <div class="aui-list-item aui-padded-l-0">
                        <div class="aui-list-item-inner">
                            <div class="aui-list-item-title aui-font-size-14 goods-title">超值单人餐</div>
                            <div class="aui-list-item-right goods-price">￥55</div>
                        </div>
                    </div>
                </ul>
            </div>
            <div class="aui-card-list-footer aui-border-t">
                <div></div>
                <div>
                    <div class="aui-btn aui-btn aui-btn-outlined aui-btn-warning">评价得积分</div>
                </div>
            </div>
        </div> -->
        <div id="empty_cart">
          <p>Your Cart is empty</p><br/>
          <div class="aui-btn aui-btn-block aui-btn-outlined" onclick="closeFrame()"tapmode>Continue shopping</div>
        </div>
    </section>
</body>
<script type="text/javascript" src="../script/api.js" ></script>
<script type="text/javascript">
    apiready = function () {
      api.parseTapmode();
      GetList();
    }
    function GetList(){
      var token = localStorage.getItem('token');
      console.log(token);
      api.ajax({
          url: 'http://mv.anhy.net/index.php?dispatch=orders.search&appajax=1&is_ajax=1',
          method: 'get',
        headers:{
          cookie:token,
          'User-Agent': 'Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.157 Mobile Safari/537.36'
        },
        returnAll:true
      },function(ret, err){
        console.warn( JSON.stringify( ret ) );
          if (ret) {
            if(ret.body.result){
            var list = ret.body.result.data.orders.value;
              console.warn( JSON.stringify( list ) );
            if(list.length >0){
              var html = Card_list(list);
              $api.html(document.getElementById('body_main'),html);
            }else{
              $api.byId('empty_cart').style.display = 'block';

            }
          }else{
            localStorage.setItem('token','');
              $api.byId('empty_cart').style.display = 'block';
          }
          } else {
              alert( JSON.stringify( err ) );
              $api.byId('empty_cart').style.display = 'block';
          }
      });

    }
    function closeFrame(){
      api.execScript({
          name: 'root',
          script: "isLogin('tabbar1','html/main.html','home');"
      });
      api.closeWin({
          name: 'OrderHistory'
      });

    }
    function Card_list(data){
      var h = '';
      data.map(function(key,index){
        h+='<div class="aui-card-list aui-border-t aui-border-b">'+
            '<div class="aui-card-list-header aui-card-list-user">'+
                '<div class="aui-card-list-user-avatar">'+
                    '<img src="../image/demo1.png">'+
                '</div>'+
                '<div class="aui-card-list-user-name">'+
                    '<div class="aui-font-size-16">'+(key.company || 'Master')+' <i class="aui-iconfont aui-icon-right aui-font-size-12"></i></div>'+
                    '<small>'+key.status+'</small>'+
                '</div>'+
                '<div class="aui-card-list-user-info">'+new Date(key.timestamp*1000).toLocaleString()+'</div>'+
            '</div>'+
            '<div class="aui-card-list-content aui-border-t" style="margin-left: 3.5rem;">'+
                '<ul class="aui-list aui-list-noborder">'+
                    '<div class="aui-list-item aui-padded-l-0">'+
                        '<div class="aui-list-item-inner">'+
                            '<div class="aui-list-item-title aui-font-size-14 goods-title">'+key.order_id+'</div>'+
                            '<div class="aui-list-item-right goods-price">$ '+key.total+'</div>'+
                        '</div>'+
                    '</div>'+
                '</ul>'+
            '</div>'+
            '<div class="aui-card-list-footer aui-border-t">'+
                '<div></div>'+
                '<div>'+
                    '<div class="aui-btn aui-btn aui-btn-outlined aui-btn-info aui-margin-r-10">再来一单</div>'+
                    '<div class="aui-btn aui-btn aui-btn-outlined aui-btn-warning">评价得积分</div>'+
                '</div>'+
            '</div>'+
        '</div>'
      })
      return h;
    }

</script>
</html>
